@model AllureRemodeling.Models.Users

@{
    ViewBag.Title = "CreateApplicantProfile";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container">

    <div class="panel" style="margin-top: 15px;">

        <div class="panel-heading" style="background-color: blue; color: white;">
            <h1>Job Opportunitinies</h1>
        </div>

        <p style="margin-top:10px; font-size:16px">
            Our company is constantly evolving and growing, but our commitment to our customers never changes.
            We give employees the tools they need to grow and advance.
            Follow your passion and build your career with us.
        </p>

        <p class="appication_received"></p>

        <div class="panel-body">

            <div class="col-md-4" style="padding-bottom: 15px;">
                <label for="addApplicant_firstName">First Name</label>
                <input id="addApplicant_firstName" class="form-control" type="text" placeholder="First Name" />
            </div>

            <div class="col-md-4" style="padding-bottom: 15px;">
                <label for="addApplicant_lastName">Last Name</label>
                <input id="addApplicant_lastName" class="form-control" type="text" placeholder="Last Name" />
            </div>

            <div class="col-md-4" style="padding-bottom: 15px;">
                <label for="addApplicant_phoneNumber">Phone Number</label>
                <input id="addApplicant_phoneNumber" class="form-control" type="text" placeholder="Phone Number" />
            </div>

            <div class="col-md-4" style="padding-bottom: 15px;">
                <label for="addApplicant_email">Email</label>
                <input id="addApplicant_email" class="form-control" type="text" placeholder="Email" />
            </div>

            <div class="col-md-4" style="padding-bottom: 15px;">
                <label for="addApplicant_address1">Address</label>
                <input id="addApplicant_address1" class="form-control" type="text" placeholder="Address" />
            </div>

            <div class="col-md-4" style="padding-bottom: 15px;">
                <label for="addApplicant_address2">Address 2</label>
                <input id="addApplicant_address2" class="form-control" type="text" placeholder="Apt#" />
            </div>

            <div class="col-md-4" style="padding-bottom: 15px;">
                <label for="addApplicant_city">City</label>
                <input id="addApplicant_city" class="form-control" type="text" placeholder="City" />
            </div>

            <div class="form-group col-md-4">
                <label for="orgSettings-mainContactState">State:</label>
                @Html.EnumDropDownListFor(m => m.State, "-- Please select your state --",
                                           new { @id= "addApplicant-State", @class = "form-control" })
            </div>

            <div class="col-md-4" style="padding-bottom: 15px;">
                <label for="addApplicant_zip">Zip Code</label>
                <input id="addApplicant_zip" class="form-control" type="text" />
            </div>

            <div class="col-md-4" style="padding-bottom: 15px;">
                <label for="addApplicant_resume">Upload Resume</label>
                <input id="addApplicant_resume" class="form-control" type="file" accept=".doc,.txt,.pdf,.docx" />
            </div>

            <div class="col-md-6 col-md-offset-4" style="padding-top: 15px;">
                <input type="button" class="btn btn-primary btn-block" id="createAccount" value="Submit" />
            </div>

        </div>

    </div>

</div>

@section Scripts
{
    <script>

        $(function () {

            function isValidEmailAddress(emailAddress) {

                var pattern = new RegExp(/^[+a-zA-Z0-9._-]+@@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/i);

                return pattern.test(emailAddress);

            }

            function isValidPhoneNumber(phoneNumber) {

                var pattern = new RegExp(/^[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}$/im);

                return pattern.test(phoneNumber);

            }

            $("#createAccount").click(function () {

                var firstName = $("#addApplicant_firstName").val();
                var lastName = $("#addApplicant_lastName").val();
                var phoneNumber = $("#addApplicant_phoneNumber").val();
                var email = $("#addApplicant_email").val();
                var address_1 = $("#addApplicant_address1").val();
                var address_2 = $("#addApplicant_address2").val();
                var city = $("#addApplicant_city").val();
                var state = $("#addApplicant-State").find(":selected").text();
                var zip = $("#addApplicant_zip").val();
                var resume = document.getElementById("addApplicant_resume").files[0];

                if (firstName && lastName && phoneNumber && email && address_1 && city && state && zip && resume) {

                    if (!isValidEmailAddress(email)) {

                        alert("This is not a valid email address.");

                    }
                    else if (!isValidPhoneNumber(phoneNumber)) {

                        alert("This is not a valid phone number");

                    }
                    else {
                        var formData = new FormData();
                        var ApplicantAccount = new Object();

                        ApplicantAccount.FirstName = firstName;
                        ApplicantAccount.LastName = lastName;
                        ApplicantAccount.PhoneNumber = phoneNumber;
                        ApplicantAccount.EmailAddress = email;
                        ApplicantAccount.Address1 = address_1;
                        ApplicantAccount.Address2 = address_2;
                        ApplicantAccount.City = city;
                        ApplicantAccount.State = state;
                        ApplicantAccount.Zip = zip;

                        formData.append("resume", resume);

                        $.ajax
                            ({
                                type: 'POST',
                                url: '@Url.Action("SaveResume", "Home")',
                                data: formData,
                                dataType: 'json',
                                contentType: false,
                                processData: false,
                                success: function (data) {
                                    $.ajax
                                        ({
                                            type: 'POST',
                                            url: '@Url.Action("AddApplicantAccount", "Home")',
                                            data: JSON.stringify(ApplicantAccount),
                                            dataType: 'json',
                                            contentType: "application/json; charset=utf-8",
                                            success: function (data) {
                                                alert("We have received your application. Thank you!")
                                            }

                                        });
                                }

                            });
                    }
                } else {

                    alert("Please fill all the required fields.");

                }

            });
        });

    </script>
}